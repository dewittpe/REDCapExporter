<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Peter DeWitt" />


<title>REDCap Exporter</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">REDCap Exporter</h1>
<h4 class="author">Peter DeWitt</h4>


<div id="TOC">
<ul>
<li><a href="#prerequisites"><span class="toc-section-number">1</span> Prerequisites</a><ul>
<li><a href="#redcap-api-tokens"><span class="toc-section-number">1.1</span> REDCap API Tokens</a></li>
<li><a href="#namespaces-options-and-system-environment-variables"><span class="toc-section-number">1.2</span> Namespaces, Options, and System Environment Variables</a></li>
</ul></li>
<li><a href="#exporting-a-redcap-project-to-a-r-data-package"><span class="toc-section-number">2</span> Exporting a REDCap Project to a R Data Package</a><ul>
<li><a href="#basic-export"><span class="toc-section-number">2.1</span> Basic Export</a></li>
<li><a href="#details-on-exported-files"><span class="toc-section-number">2.2</span> Details on exported Files</a></li>
<li><a href="#other-notes"><span class="toc-section-number">2.3</span> Other notes</a><ul>
<li><a href="#check-the-r-data-package"><span class="toc-section-number">2.3.1</span> Check the R Data Package</a></li>
<li><a href="#using-the-exported-package"><span class="toc-section-number">2.3.2</span> Using the Exported Package</a></li>
</ul></li>
</ul></li>
<li><a href="#general-tools"><span class="toc-section-number">3</span> General Tools</a><ul>
<li><a href="#specific-export-methods"><span class="toc-section-number">3.1</span> Specific Export Methods</a></li>
<li><a href="#data-import-tools"><span class="toc-section-number">3.2</span> Data Import Tools</a></li>
</ul></li>
<li><a href="#session-info"><span class="toc-section-number">4</span> Session Info</a></li>
</ul>
</div>

<p>The purpose of this vignette is to show how to export a REDCap project into a R data package. There are some prerequisites, described in detail in the first section, you will need to address before running the examples.</p>
<p>The primary objective of the <em>REDCapExporter</em> is to export all the data from an REDCap project via the REDCap API and build a R data package with useful documentation and tools. The data package will make it easy to archive data and distribute data, in an analysis ready format, within a group of analysts.</p>
<p>Additionally, examples and use of the specific tools from the <em>REDCapExporter</em> package are provided. If you are an analyst working on a live project, the use of these tools might be helpful for building on the fly or routine data reports.</p>
<p><strong>Disclaimer and Warning:</strong> It is the responsibility of the end user to protect sensitive data. Do not use <em>REDCapExporter</em> to export data onto a computer that should not have sensitive data stored on it. Further, do not distribute the resulting R package to any other machine or person who does not have data access rights.</p>
<p>For the example in this vignette we created a REDCap project storing the roster and statistics for the 2000-2001 Stanley Cup Champion Colorado Avalanche of the National Hockey League. The data was acquired from the web page <a href="https://www.hockey-reference.com/teams/COL/2001.html">Hockey Reference</a>.</p>
<div id="prerequisites" class="section level1">
<h1><span class="header-section-number">1</span> Prerequisites</h1>
<div id="redcap-api-tokens" class="section level2">
<h2><span class="header-section-number">1.1</span> REDCap API Tokens</h2>
<p>You will need to have API Export rights for the REDCap project you are looking to export into an R data package. Contact the project owner, system admin, or go through your institution’s REDCap page to acquire an API token.</p>
<p>Remember, your API token is the equivalent of a username/password combination. Thus, you must treat the token with the same, or more, level of security you would treat any username/password combination. <strong>DO NOT PUT THE TOKEN IN PLAIN TEXT!</strong></p>
<p>We suggest the reader set up a vault with their API token as a secret. via the <em><a href="https://cran.r-project.org/package=secret">secret</a></em> package. We encourage the reader to read the “secrets” vignette in R via: <code>vignette(topic = &quot;secrets&quot;, package = &quot;secret&quot;)</code> .</p>
<p>For the rest of this vignette we will use <code>secret::get_secret</code> to access a REDCap API token.</p>
</div>
<div id="namespaces-options-and-system-environment-variables" class="section level2">
<h2><span class="header-section-number">1.2</span> Namespaces, Options, and System Environment Variables</h2>
<p>For this example we will load and attach the following namespaces and set several options and system environment variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(REDCapExporter)
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(secret)
<span class="kw">library</span>(qwraps2)

<span class="kw">options</span>(<span class="st">&quot;datatable.print.topn&quot;</span>  =<span class="st"> </span><span class="dv">3</span>)
<span class="kw">options</span>(<span class="st">&quot;datatable.print.nrows&quot;</span> =<span class="st"> </span><span class="dv">6</span>)

<span class="co"># Set the private key needed to access the vault, if needed.</span>
<span class="kw">Sys.setenv</span>(<span class="dt">USER_KEY =</span> <span class="st">&quot;~/.ssh/vaults&quot;</span>)

<span class="co"># REDCap API uri and token</span>
<span class="kw">Sys.setenv</span>(<span class="dt">REDCap_API_URI =</span> <span class="st">&quot;https://redcap.ucdenver.edu/api/&quot;</span>)
<span class="kw">Sys.setenv</span>(<span class="dt">REDCap_API_TOKEN =</span> <span class="kw">get_secret</span>(<span class="st">&quot;2000_2001_Avalanche&quot;</span>))

<span class="co"># Set the option the format the data will be returned in.  Possible values are</span>
<span class="co"># 'csv', 'xml', or 'json'.   Methods to build data sets from csv and json have</span>
<span class="co"># been built, xml is not yet supported.  csv is the default format.</span>
<span class="kw">Sys.getenv</span>(<span class="st">&quot;REDCap_API_format&quot;</span>)</code></pre></div>
</div>
</div>
<div id="exporting-a-redcap-project-to-a-r-data-package" class="section level1">
<h1><span class="header-section-number">2</span> Exporting a REDCap Project to a R Data Package</h1>
<div id="basic-export" class="section level2">
<h2><span class="header-section-number">2.1</span> Basic Export</h2>
<p>Exporting a REDCap project to a R data package is done with a call to <code>export_redcap_project</code> . The output of the call is a syntactically valid source R package directory. The arguments for the call are</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(export_redcap_project)</code></pre></div>
<p>The uri and token can be passed explicitly here, if omitted, the values in the system environment variables will be used. The path argument is a directory on your machine were the R data package is going to be built. For this vignette we will use a temporary directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temppath &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</code></pre></div>
<p>Exporting the project will require you to provide at some information about the users. In this context, users are the persons who have, or had, access to the REDCap project and are listed under the UserRights section of the REDCap proejct. The user data from REDCap is used to construct the Author section of the DESCRIPTION file for the R data package to be constucted. By default, all users are listed as ‘contributors’. Modification of the roles can be provide by a named list object. In the example below, the user dewittp is going to assigned the creator and author role. To be a valid R package, at least one user will need to have the creator role assigned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">export_redcap_project</span>(<span class="dt">path =</span> temppath,
                      <span class="dt">author_roles =</span> <span class="kw">list</span>(<span class="dt">dewittp =</span> <span class="kw">c</span>(<span class="st">&quot;cre&quot;</span>, <span class="st">&quot;aut&quot;</span>)))</code></pre></div>
<p>The resulting directory is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fs<span class="op">::</span><span class="kw">dir_tree</span>(temppath)</code></pre></div>
</div>
<div id="details-on-exported-files" class="section level2">
<h2><span class="header-section-number">2.2</span> Details on exported Files</h2>
<p>First, the package directory name. Exported packages from <em>REDCapExporter</em> will have the directory name rcd<package-id>. This name is also used in the DESCRIPTION file.</p>
<p>The DESCRIPTION file is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prj_dir &lt;-<span class="st"> </span><span class="kw">list.dirs</span>(temppath)
prj_dir &lt;-<span class="st"> </span>prj_dir[<span class="kw">grepl</span>(<span class="st">&quot;/rcd</span><span class="ch">\\</span><span class="st">d+$&quot;</span>, prj_dir)]
<span class="kw">t</span>(<span class="kw">read.dcf</span>(<span class="kw">paste</span>(prj_dir, <span class="st">&quot;DESCRIPTION&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)))</code></pre></div>
<p>The title comes from the project info recorded in REDCap. The version number is set as the year.month.day.hour.minute of the export. As noted above, the Author field is built from the user data stored in REDCap.</p>
<p>The LICENSE file notes that the package is proprietary and should not be installed or distributed to others who are not authorized to have access to the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="kw">paste</span>(prj_dir[<span class="dv">1</span>], <span class="st">&quot;LICENSE&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre></div>
<p>The raw data exports are stored as .rds files under inst/raw-data so that these files will be available in R sesssions after installing the package.</p>
<p>The data directory has data.table versions of the data sets.</p>
<p>The R/datasets.R file provides the documentation for the data sets which can be accessed in an interactive R session.</p>
</div>
<div id="other-notes" class="section level2">
<h2><span class="header-section-number">2.3</span> Other notes</h2>
<div id="check-the-r-data-package" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Check the R Data Package</h3>
<p>The generated R data package should pass the basic R CMD check.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">check &lt;-<span class="st"> </span>devtools<span class="op">::</span><span class="kw">check</span>(<span class="dt">pkg =</span> prj_dir, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
check</code></pre></div>
</div>
<div id="using-the-exported-package" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Using the Exported Package</h3>
<p>Let’s install the package and explore the contents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="kw">grep</span>(<span class="st">&quot;*.tar.gz&quot;</span>, <span class="kw">list.files</span>(<span class="dt">path =</span> prj_dir, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dt">value =</span> <span class="ot">TRUE</span>),
                 <span class="dt">lib =</span> temppath)

<span class="kw">library</span>(rcd14465, <span class="dt">lib.loc =</span> temppath)</code></pre></div>
<p>The available data sets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="dt">package =</span> <span class="st">&quot;rcd14465&quot;</span>)<span class="op">$</span>results</code></pre></div>
<p>A simple data analysis question: how many goals were scored by position?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.data.table</span>(record)[, <span class="kw">sum</span>(goals), by =<span class="st"> </span>position]</code></pre></div>
</div>
</div>
</div>
<div id="general-tools" class="section level1">
<h1><span class="header-section-number">3</span> General Tools</h1>
<p>The <em>REDCapExporter</em> package provides several functions and methods which the user may find useful. These functions and methods are used within the package to export and create a R data package. Use of the methods for specific projects, say exporting data from a REDCap project for routine reports or interim analyses.</p>
<div id="specific-export-methods" class="section level2">
<h2><span class="header-section-number">3.1</span> Specific Export Methods</h2>
<p>The method <code>&quot;export_content&quot;</code> can be used to export specific parts of a REDCap project. Three of the arguments, uri, token, and format, if omitted, will default to the system environment variables. Thus, only the content argument must be defined by the user. Additional arguments for the API are passed via the ellipses. Check your specific REDCap API documentation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(export_content)</code></pre></div>
<p>For example, the project information and project metadata can be obtained via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avs_raw_project_info &lt;-<span class="st"> </span><span class="kw">export_content</span>(<span class="dt">content =</span> <span class="st">&quot;project&quot;</span>)
avs_raw_metadata     &lt;-<span class="st"> </span><span class="kw">export_content</span>(<span class="dt">content =</span> <span class="st">&quot;metadata&quot;</span>)</code></pre></div>
<p>The return object from <code>export_content</code> are character strings as you would expect from a call to <code>postForm</code> from the <em><a href="https://cran.r-project.org/package=RCurl">RCurl</a></em> package. A couple additional attributes have been added. The <code>Sys.time</code> for the call and the class <code>&quot;rcer_raw_*&quot;</code> where * is replaced by the value of the content argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(avs_raw_project_info)
<span class="kw">str</span>(avs_raw_metadata)</code></pre></div>
<p>We opted to have <code>export_content</code> return a character string such that the end user can may select the format for the return and use the tool of their choice for creating a data.frame or other objects. However, as you will see in the next section there are default methods for building data frames.</p>
</div>
<div id="data-import-tools" class="section level2">
<h2><span class="header-section-number">3.2</span> Data Import Tools</h2>
<p>When working with REDCap data it is likely that you will have more columns than you would want to have to code a data import method for yourself. This is especially true if you need to deal with columns that may look like numeric values but are really categorical. We provide some tools to help with the data import process.</p>
<p>First, you will need to get the project metadata and record.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avs_raw_metadata &lt;-<span class="st"> </span><span class="kw">export_content</span>(<span class="dt">content =</span> <span class="st">&quot;metadata&quot;</span>)
avs_raw_metadata

avs_raw_record   &lt;-<span class="st"> </span><span class="kw">export_content</span>(<span class="dt">content =</span> <span class="st">&quot;record&quot;</span>)
avs_raw_record</code></pre></div>
<p>There are <code>as.data.frame</code> and <code>as.data.table</code> methods for translating the raw export to the noted class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avs_metadata &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(avs_raw_metadata)
avs_record   &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(avs_raw_record)</code></pre></div>
<p>The initial mapping to a data frame treats all columns as character.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all</span>(<span class="kw">sapply</span>(avs_metadata, mode) <span class="op">==</span><span class="st"> &quot;character&quot;</span>)
<span class="kw">all</span>(<span class="kw">sapply</span>(avs_record, mode) <span class="op">==</span><span class="st"> &quot;character&quot;</span>)</code></pre></div>
<p>To create a data frame with useful data storage modes in each column you can use <code>format_record</code> . The easiest option is to pass the record and metadata to <code>format_record</code> as shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp1 &lt;-<span class="st"> </span><span class="kw">format_record</span>(<span class="dt">record =</span> avs_record, <span class="dt">metadata =</span> avs_raw_metadata)
<span class="kw">str</span>(temp1[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</code></pre></div>
<p>The mode for each column is defined by the function call <code>col_type</code> . The default modes are set via the metadata:</p>
<p>NOTES:</p>
<ul>
<li><p>Dates can be entered into REDCap as mdy, dmy, or ymd. However, it appears that the record will have the date in ymd format regardless of the input format.</p></li>
<li><p>Multiple Choice fields can be set as character by passing <code>factor = FALSE</code> to <code>col_type</code> .</p></li>
<li><p>Additional defaults are to be defined.</p></li>
</ul>
<p>If the user wishes to define the storage mode for a specific subset of columns we recommend the user call <code>col_type</code> explicitly, store the result, modify as needed, then pass the modified object to <code>format_record</code> . For example, we will set <code>hof</code> which is yes/no variable to logical, and modify the height column to be in meters instead of inches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ct &lt;-<span class="st"> </span><span class="kw">col_type</span>(avs_metadata)
ct<span class="op">$</span>hof &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="kw">as.logical</span>(<span class="kw">as.integer</span>(hof)))
ct<span class="op">$</span>height &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="fl">0.0254</span> <span class="op">*</span><span class="st"> </span><span class="kw">as.numeric</span>(height))

temp2 &lt;-<span class="st"> </span><span class="kw">format_record</span>(avs_raw_record, <span class="dt">col_type =</span> ct)
<span class="kw">str</span>(temp2[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</code></pre></div>
</div>
</div>
<div id="session-info" class="section level1">
<h1><span class="header-section-number">4</span> Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">sessionInfo</span>(), <span class="dt">local =</span> <span class="ot">FALSE</span>)
<span class="co">#</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
